{% extends "navigate.html" %} {% block mainbody %}


<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
    <meta charset="utf-8" />
    <script src="/static/js/echarts.js"></script>

</head>
<title>Entity Lookup</title>
<div class="container">
    <div class="row">
        <!--head start-->
        <div class="col-md-12">
            <h3 class="page-header"><i class="fa fa-share-alt" aria-hidden="true"></i> Entity Lookup </h3>
            <ol class="breadcrumb">
                <li><i class="fa fa-home"></i><a href="\">Home</a></li>
                <li><i class="fa fa-share-alt" aria-hidden="true"></i>Entity Lookup</li>
            </ol>
        </div>
        <div class="col-md-12">
            <div class="panel panel-default ">
                <header class="panel-heading">
                    Query conditions:
                </header>
                <div class="panel-body">
                    <!--搜索框-->
                    <form method="get" id='searchEntityForm'>
                        <div>
                            <div class="input-group">
                                <input type="text" id="user_text" name="user_text" class="form-control"
                                    placeholder="Enter disease name, drug name, symptom name"
                                    aria-describedby="basic-addon1">
                                <span class="btn btn-primary input-group-addon" type="button" id="relationSearchButton"
                                    style="background-color:#4592fe ; padding:6px 38px"
                                    onclick="document.getElementById('searchEntityForm').submit();">Inquire</span>
                            </div>
                        </div>
                    </form>
                </div>
            </div>


        </div>
        <p>
        <div class="col-md-12">
            {% if ctx %}
            <div class="panel panel-default">
                <header class="panel-heading">
                    <div class="panel-body">
                        <h2>The entity has not been added to the knowledge base yet</h2>
                    </div>
                </header>
            </div>
            {% endif %}
        </div>
        </p>
        {% if entityRelation %}
        <div class="col-md-12">
            <div class="panel panel-default ">
                <header class="panel-heading">
                    relation chart :
                </header>
                <div class="panel-body ">
                    <div id="graph" style="width: 90%;height:600px;"></div>
                </div>
            </div>
        </div>
        {% endif %}
        {% if entityRelation %}
        <div class="col-md-12">
            <div class="panel panel-default">
                <header class="panel-heading">
                    relationship list :
                </header>
                <div class="panel-body">
                    <table class="table" data-paging="true" id="myTable" data-sorting="true"></table>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% if entityRelation %}
<script src="/static/js/jquery.min.js"></script>
<script type="text/javascript">
    var ctx = [];
    var entityRelation = [];

    var data = [];
    var links = [];

    var id = 0;
    for (var i = 0; i < entityRelation[0].length; i++) {
        node1 = {};
        node1['name'] = entityRelation[0][i]['source'];
        node1['draggable'] = true;

        var flag = 1;

        relationTarget = id.toString();
        for (var j = 0; j < data.length; j++) {
            if (data[j]['name'] == node1['name']) {
                flag = 0;
                relationTarget = data[j]['id'];
                break;
            }
        }

        node1['id'] = relationTarget;
        if (flag == 1) {
            id++;
            data.push(node1);
        }

        node2 = {};
        node2['name'] = entityRelation[0][i]['target'];
        node2['draggable'] = true;

        flag = 1;
        relationTarget = id.toString();
        for (var j = 0; j < data.length; j++) {
            if (data[j]['name'] == node2['name']) {
                flag = 0;
                relationTarget = data[j]['id'];
                break;
            }
        }
        node2['id'] = relationTarget;
        if (flag == 1) {
            id++;
            data.push(node2);
        }

        relation = {}
        relation['source'] = node1['id'];
        relation['target'] = node2['id'];
        flag = 1;
        for (var j = 0; j < links.length; j++) {
            if (links[j]['source'] == relation['source'] && links[j]['target'] == relation['target']) {
                links[j]['value'] = links[j]['value'] + ' & ' + entityRelation[0][i]['rel_type'];
                flag = 0;
                break;
            }
        }
        if (flag == 1) {
            relation['value'] = entityRelation[0][i]['rel_type'];
            relation['symbolSize'] = 10;
            links.push(relation);
        }

    }


    tableData = []
    for (var i = 0; i < entityRelation[0].length; i++) {
        relationData = {};
        relationData['entity1'] = entityRelation[0][i]['source'];
        relationData['relation'] = entityRelation[0][i]['rel_type'];
        relationData['entity2'] = entityRelation[0][i]['target'];

        tableData.push(relationData);
    }

    jQuery(function () {
        $('.table').footable({
            "columns": [{ "name": "entity1", title: "Entity1" },
            { "name": "relation", title: "Relation" },
            { "name": "entity2", title: "Entity2" }],
            "rows": tableData,
            "filtering": {
                "enabled": true
            }
        });
    });



    var myChart = echarts.init(document.getElementById('graph'));
    option = {
        title: {
            text: ''
        },
        tooltip: {},
        animationDurationUpdate: 1500,
        animationEasingUpdate: 'quinticInOut',
        label: {
            normal: {
                show: true,
                textStyle: {
                    fontSize: 12
                },
            }
        },
        legend: {
            x: "center",
            show: false
        },
        series: [
            {
                type: 'graph',
                layout: 'force',
                symbolSize: 45,
                focusNodeAdjacency: true,
                roam: true,
                edgeSymbol: ['none', 'arrow'],
                categories: [{
                    name: 'Bank',
                    itemStyle: {
                        normal: {
                            color: "#009800",
                        }
                    }
                }, {
                    name: 'Serise',
                    itemStyle: {
                        normal: {
                            color: "#4592FF",
                        }
                    }
                }, {
                    name: 'Instance',
                    itemStyle: {
                        normal: {
                            color: "#C71585",
                        }
                    }
                }],
                label: {
                    normal: {
                        show: true,
                        textStyle: {
                            fontSize: 12,
                        },
                    }
                },               //
                force: {
                    repulsion: 1000
                },
                edgeSymbolSize: [4, 50],
                edgeLabel: {
                    normal: {
                        show: true,
                        textStyle: {
                            fontSize: 10
                        },
                        formatter: "{c}"
                    }
                },
                data: data,
                links: links,
                lineStyle: {
                    normal: {
                        opacity: 0.9,
                        width: 1.3,
                        curveness: 0,
                        color: "#262626"
                    }
                }
            }
        ]
    };
    myChart.setOption(option);
</script>
{% endif %}

{% endblock %}